# Домашнее задание к занятию «Обновление приложений»

-------

### Задание 1. Выбрать стратегию обновления приложения и описать ваш выбор

1. Имеется приложение, состоящее из нескольких реплик, которое требуется обновить.
2. Ресурсы, выделенные для приложения, ограничены, и нет возможности их увеличить.
3. Запас по ресурсам в менее загруженный момент времени составляет 20%.
4. Обновление мажорное, новые версии приложения не умеют работать со старыми.
5. Вам нужно объяснить свой выбор стратегии обновления приложения.

### Задание 2. Обновить приложение

1. Создать deployment приложения с контейнерами nginx и multitool. Версию nginx взять 1.19. Количество реплик — 5.
2. Обновить версию nginx в приложении до версии 1.20, сократив время обновления до минимума. Приложение должно быть доступно.
3. Попытаться обновить nginx до версии 1.28, приложение должно оставаться доступным.
4. Откатиться после неудачного обновления.

-----

### 1) Стратегия "Rolling Update"

Процесс Rolling Update включает в себя создание новых экземпляров приложения с новой версией и постепенную остановку и замену старых экземпляров. Вот как это работает:

Подготовка новой версии приложения: Сначала вам необходимо подготовить новую версию вашего контейнера или приложения. Это может быть новый Docker-образ с обновленным кодом, конфигурацией или другими изменениями.

Обновление манифеста ресурса Deployment: Для управления процессом обновления используется ресурс Deployment. В манифесте Deployment вы определяете параметры, такие как количество реплик, образ, стратегию обновления и другие настройки.

Стратегия обновления: В разделе стратегии spec.strategy манифеста Deployment вы можете указать стратегию обновления. Для Rolling Update используется стратегия RollingUpdate. Вы можете настроить параметры, такие как maxSurge (максимальное количество дополнительных подов при обновлении) и maxUnavailable (максимальное количество недоступных подов при обновлении).

Запуск обновления: После обновления манифеста Deployment k8s начнет процесс обновления. Он постепенно останавливает старые поды и запускает новые поды с обновленной версией. Параметры maxSurge и maxUnavailable определяют скорость и масштаб замены подов.

Мониторинг процесса: Во время обновления k8s автоматически мониторит состояние подов и убеждается, что новые поды стартуют успешно и работают стабильно.

Завершение обновления: По мере того как новые поды успешно запускаются и становятся готовыми, старые поды постепенно останавливаются и удаляются.
### 2) Создал [Deployment](deploy/deployment.yaml)
Для обновления Image требуется изменить в Deploy значение с 1.19 на 1.20, стратегия тут будет Rolling Update, в данной стратегии, при обновлении, Kubernetes постепенно заменяет старые поды на новые, одновременно поддерживая доступность приложения. После попытки изменить Image 1.28 произошла ошибка можно сделать rollback командой - "kubectl rollout undo deployment deployment.yaml".
