# Домашнее задание к занятию «Обновление приложений»

-------

### Задание 1. Выбрать стратегию обновления приложения и описать ваш выбор

1. Имеется приложение, состоящее из нескольких реплик, которое требуется обновить.
2. Ресурсы, выделенные для приложения, ограничены, и нет возможности их увеличить.
3. Запас по ресурсам в менее загруженный момент времени составляет 20%.
4. Обновление мажорное, новые версии приложения не умеют работать со старыми.
5. Вам нужно объяснить свой выбор стратегии обновления приложения.

### Задание 2. Обновить приложение

1. Создать deployment приложения с контейнерами nginx и multitool. Версию nginx взять 1.19. Количество реплик — 5.
2. Обновить версию nginx в приложении до версии 1.20, сократив время обновления до минимума. Приложение должно быть доступно.
3. Попытаться обновить nginx до версии 1.28, приложение должно оставаться доступным.
4. Откатиться после неудачного обновления.

-----

### 1) Стратегия "Canary Update"

Canary Deployment позволяет постепенно внедрять новую версию приложения, оценивая её работоспособность в ограниченном объёме трафика, прежде чем полностью перейти на новую версию.

Вот как это может быть реализовано:

Подготовка новой версии:

Создайте новую версию приложения, которую вы хотите развернуть.
Выбор целевой группы:

Определите небольшую долю пользователей или трафика (например, 10-20%), которую вы готовы направить на новую версию. Это будут ваши "канареечные" пользователи.
Развертывание канареечной версии:

Разверните новую версию приложения только для выбранной группы пользователей. Остальной трафик продолжит направляться на текущую версию.
Мониторинг и тестирование:

Внимательно мониторьте работоспособность новой версии приложения для "канареечных" пользователей. Оцените её производительность, стабильность и отсутствие ошибок.
Постепенное увеличение доли трафика:

Если новая версия приложения проявляет себя стабильно и без проблем, постепенно увеличивайте долю трафика, направляемого на новую версию. Например, наращивайте эту долю на 10% каждый час.
Мониторинг и реакция:

Продолжайте мониторить производительность и стабильность новой версии приложения. Если возникают проблемы, вы можете быстро вернуть трафик на старую версию.
Полное развертывание:

Если новая версия прошла проверку и не выявила критических проблем, увеличьте долю трафика до 100% и полностью перейдите на новую версию.

### 2) Создал [Deployment](deploy/deployment.yaml)
Для обновления Image требуется изменить в Deploy значение с 1.19 на 1.20, стратегия тут будет Rolling Update, в данной стратегии, при обновлении, Kubernetes постепенно заменяет старые поды на новые, одновременно поддерживая доступность приложения. После попытки изменить Image 1.28 произошла ошибка можно сделать rollback командой - "kubectl rollout undo deployment deployment.yaml".
