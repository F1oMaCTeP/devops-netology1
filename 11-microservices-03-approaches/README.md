# Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

1) Предлагается использовать облачную систему для хранения исходного кода и непрерывной интеграции. Для системы контроля версий используется Git. Каждый сервис имеет свой репозиторий. Сборка запускается по событию из Git или по кнопке с указанием параметров. Настройки могут быть привязаны к каждой сборке, а шаблоны могут быть созданы для различных конфигураций сборок. Секретные данные (пароли, ключи доступа) безопасно хранятся. Можно создать несколько конфигураций для сборки из одного репозитория и использовать кастомные шаги при сборке. Для сборки проектов используются собственные докер-образы. Агенты сборки могут быть развернуты на собственных серверах. Можно запускать несколько сборок и тестов параллельно.

2) Для решения задачи сбора и анализа логов в микросервисной архитектуре можно использовать Elastic Stack, включающий в себя Elasticsearch, Logstash и Kibana.

    Elasticsearch - это распределенный поисковой и аналитический движок, который может использоваться для хранения и поиска больших объемов данных, таких как логи. Logstash - это инструмент для сбора, обработки и передачи логов. Kibana - это веб-интерфейс для визуализации и анализа данных, сохраненных в Elasticsearch.

    Для сбора логов из stdout на каждом хосте можно использовать Logstash, который позволяет настроить конфигурацию для сбора логов из разных источников. После сбора логов они могут быть отправлены на центральный сервер, где используется Elasticsearch для хранения и индексации логов.

    Для обеспечения поиска и фильтрации по записям логов, Kibana предоставляет пользовательский интерфейс с широкими возможностями фильтрации и поиска по логам. Разработчики могут получить доступ к этому интерфейсу, чтобы анализировать и отслеживать логи своих сервисов.

    Также Kibana позволяет сохранять поисковые запросы и отчеты, которые можно поделиться ссылкой, что упрощает совместную работу и дает возможность быстро вернуться к ранее выполненным запросам.

    Таким образом, Elastic Stack обеспечивает надежный и эффективный способ сбора и анализа логов в микросервисной архитектуре с минимальными требованиями к приложениям.

3) Для решения задачи сбора и анализа состояния хостов и сервисов в микросервисной архитектуре можно использовать платформу мониторинга Prometheus для сбора метрик, а также Grafana для их визуализации и анализа. Prometheus собирает метрики со всех хостов и сервисов, включая метрики ресурсов хостов и потребления ресурсов сервисами, а также метрики, специфичные для каждого сервиса. Grafana обеспечивает пользовательский интерфейс для запросов и агрегирования информации, а также настройки панелей для отслеживания состояния системы.